<Window x:Class="VoiceLite.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VoiceLite.Utilities"
        Title="VoiceLite" Height="500" Width="620"
        Icon="VoiceLite.ico"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="True"
        StateChanged="Window_StateChanged"
        Background="#F8F9FA"
        BorderThickness="0"
        AllowsTransparency="False"
        ResizeMode="CanResize"
        TextOptions.TextRenderingMode="ClearType"
        TextOptions.TextFormattingMode="Display"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True">

    <!-- Value Converters -->
    <Window.Resources>
        <local:RelativeTimeConverter x:Key="RelativeTimeConverter"/>
        <local:TruncateTextConverter x:Key="TruncateTextConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>   <!-- Title bar -->
            <RowDefinition Height="Auto"/>   <!-- Config info -->
            <RowDefinition Height="*"/>      <!-- History panel (fills ALL space) -->
            <RowDefinition Height="Auto"/>   <!-- Buttons -->
        </Grid.RowDefinitions>

        <!-- Title bar with status -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="VoiceLite"
                       FontSize="16" FontWeight="SemiBold"
                       Foreground="#4A4A4A"
                       HorizontalAlignment="Left"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                <Ellipse x:Name="StatusIndicator" Width="10" Height="10" Fill="#C8E6C9" Margin="0,0,6,0"/>
                <TextBlock x:Name="StatusText" Text="Ready"
                          Foreground="#7A7A7A" FontWeight="Normal" FontSize="14"/>
            </StackPanel>
        </Grid>

        <!-- Configuration information (simplified) -->
        <StackPanel Grid.Row="1" Margin="0,0,0,8" Orientation="Horizontal">
            <TextBlock Text="Hotkey: " Foreground="#7A7A7A" FontSize="13"/>
            <TextBlock x:Name="HotkeyText" Text="F1" Foreground="#4A4A4A" FontWeight="SemiBold" FontSize="13"/>

            <TextBlock Text="  •  " Foreground="#E0E0E0" FontSize="13" VerticalAlignment="Center"/>

            <TextBlock Text="Model: " Foreground="#7A7A7A" FontSize="13"/>
            <TextBlock x:Name="ModelText" Text="Lite (Free)" Foreground="#4A4A4A" FontWeight="SemiBold" FontSize="13"/>

            <!-- Hidden UI elements used for state storage (not displayed but referenced in MainWindow.xaml.cs) -->
            <TextBlock x:Name="MicrophoneText" Text="Default" Visibility="Collapsed"/>
            <TextBlock x:Name="AccountStatusText" Text="Not signed in" Visibility="Collapsed"/>
        </StackPanel>

        <!-- HISTORY PANEL (replaces transcription box - fills all remaining space) -->
        <Border Grid.Row="2"
                BorderBrush="#E0E0E0"
                BorderThickness="1"
                Background="White"
                CornerRadius="8"
                Margin="0,0,0,12">
            <Border.Effect>
                <DropShadowEffect Color="#000000" BlurRadius="6" ShadowDepth="1" Opacity="0.06" Direction="270"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Compact header -->
                    <RowDefinition Height="*"/>    <!-- Scrollable list -->
                </Grid.RowDefinitions>

                <!-- Enhanced Header with Search -->
                <Border Grid.Row="0"
                        Background="#FAFAFA"
                        BorderBrush="#E0E0E0"
                        BorderThickness="0,0,0,1"
                        CornerRadius="8,8,0,0"
                        Padding="16,12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Top row: Title and Count -->
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Recent Transcriptions"
                                           FontWeight="SemiBold"
                                           FontSize="14"
                                           Foreground="#2C3E50"
                                           VerticalAlignment="Center"/>
                                <TextBlock x:Name="HistoryCountText"
                                           Text="• 0 items"
                                           FontSize="12"
                                           Foreground="#95A5A6"
                                           Margin="8,0,0,0"
                                           VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Compact action buttons (ghost style) -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="ToggleSearchButton"
                                        Content="🔍"
                                        Height="28"
                                        Width="28"
                                        Background="Transparent"
                                        BorderBrush="Transparent"
                                        BorderThickness="0"
                                        Foreground="#7A8899"
                                        FontSize="14"
                                        Cursor="Hand"
                                        Click="ToggleSearchButton_Click"
                                        ToolTip="Toggle search box (Ctrl+F)"
                                        Margin="0,0,8,0"/>
                                <Button x:Name="HistoryMenuButton"
                                        Content="•••"
                                        Height="28"
                                        Width="32"
                                        Background="Transparent"
                                        BorderBrush="Transparent"
                                        BorderThickness="0"
                                        Foreground="#7A8899"
                                        FontSize="16"
                                        FontWeight="Bold"
                                        Cursor="Hand"
                                        Click="HistoryMenuButton_Click"
                                        ToolTip="History actions">
                                    <Button.ContextMenu>
                                        <ContextMenu x:Name="HistoryActionsMenu">
                                            <MenuItem Header="Clear" Click="ClearHistory_Click" ToolTip="Clear all unpinned items"/>
                                            <MenuItem Header="Clear All" Click="ClearAllHistory_Click" ToolTip="Delete all items including pinned"/>
                                            <Separator/>
                                            <MenuItem Header="Export..." Click="ExportHistory_Click" ToolTip="Export history to text file"/>
                                        </ContextMenu>
                                    </Button.ContextMenu>
                                </Button>
                            </StackPanel>
                        </Grid>

                        <!-- Bottom row: Search box (hidden by default) -->
                        <Grid x:Name="SearchBoxRow" Grid.Row="1" Visibility="Collapsed">
                            <Border Background="White"
                                    BorderBrush="#E0E0E0"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="8,4">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Search icon -->
                                    <TextBlock Grid.Column="0"
                                              Text="🔍"
                                              FontSize="12"
                                              Foreground="#95A5A6"
                                              Margin="0,0,6,0"
                                              VerticalAlignment="Center"/>

                                    <!-- Search textbox -->
                                    <TextBox x:Name="HistorySearchBox"
                                            Grid.Column="1"
                                            BorderThickness="0"
                                            Background="Transparent"
                                            FontSize="12"
                                            VerticalAlignment="Center"
                                            TextChanged="HistorySearchBox_TextChanged"
                                            KeyDown="HistorySearchBox_KeyDown">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="TextBox">
                                                            <Grid>
                                                                <TextBlock Text="Search transcriptions... (Ctrl+F)"
                                                                          FontSize="12"
                                                                          Foreground="#95A5A6"
                                                                          VerticalAlignment="Center"
                                                                          Visibility="{Binding Text, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}"/>
                                                                <ScrollViewer x:Name="PART_ContentHost"/>
                                                            </Grid>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>

                                    <!-- Clear search button -->
                                    <Button x:Name="ClearSearchButton"
                                           Grid.Column="2"
                                           Content="✕"
                                           Width="20"
                                           Height="20"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="#95A5A6"
                                           FontSize="14"
                                           Cursor="Hand"
                                           Click="ClearSearchButton_Click"
                                           Visibility="Collapsed"
                                           ToolTip="Clear search (Esc)"/>
                                </Grid>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Scrollable History List -->
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Padding="12,10,12,10"
                              CanContentScroll="True"
                              ScrollViewer.IsDeferredScrollingEnabled="False"
                              VirtualizingPanel.IsVirtualizing="False"
                              VirtualizingPanel.VirtualizationMode="Recycling"
                              VirtualizingPanel.ScrollUnit="Pixel">
                    <StackPanel x:Name="HistoryItemsPanel">
                        <!-- History items added programmatically -->

                        <!-- Empty state -->
                        <StackPanel x:Name="EmptyHistoryMessage"
                                   Margin="20,40,20,20"
                                   HorizontalAlignment="Center"
                                   Visibility="Visible">
                            <TextBlock Text="Ready to transcribe"
                                      TextAlignment="Center"
                                      Foreground="#7A7A7A"
                                      FontSize="16"
                                      FontWeight="SemiBold"
                                      Margin="0,0,0,12"/>
                            <TextBlock x:Name="EmptyStateHotkeyHint"
                                      Text="Press LeftShift to start recording"
                                      TextAlignment="Center"
                                      Foreground="#B0B0B0"
                                      FontSize="14"
                                      Margin="0,0,0,8"/>
                            <TextBlock Text="Your voice will be transcribed and inserted automatically"
                                      TextAlignment="Center"
                                      Foreground="#C0C0C0"
                                      FontSize="12"
                                      TextWrapping="Wrap"
                                      LineHeight="18"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Buttons -->
        <Grid Grid.Row="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Button x:Name="DictionaryButton"
                        Grid.Column="0"
                        Content="VoiceShortcuts"
                        Height="40"
                        Background="#F5F5F5"
                        Foreground="#2C3E50"
                        BorderBrush="#E0E0E0"
                        BorderThickness="1"
                        FontWeight="SemiBold"
                        FontSize="13"
                        Cursor="Hand"
                        Click="DictionaryButton_Click"
                        ToolTip="Manage voice shortcuts and custom word replacements (Ctrl+D)"/>

                <Button x:Name="SettingsButton"
                        Grid.Column="2"
                        Content="Settings"
                        Height="40"
                        Background="#4169E1"
                        Foreground="White"
                        BorderBrush="#4169E1"
                        BorderThickness="1"
                        FontWeight="SemiBold"
                        FontSize="13"
                        Cursor="Hand"
                        Click="SettingsButton_Click"
                        ToolTip="Open settings (Ctrl+,)"/>

                <!-- Account button removed - access via system tray menu -->
            </Grid>

            <CheckBox Grid.Row="1"
                     x:Name="MinimizeCheckBox"
                     Content="Minimize to system tray on close"
                     Foreground="#7A7A7A"
                     FontSize="12"
                     IsChecked="True"
                     HorizontalAlignment="Left"
                     Margin="0,16,0,0"/>
        </Grid>

        <!-- Hidden transcription text box for state storage (referenced in MainWindow.xaml.cs) -->
        <TextBox x:Name="TranscriptionText"
                 Grid.Row="2"
                 Visibility="Collapsed"
                 Text="Ready to transcribe"/>
    </Grid>
</Window>
