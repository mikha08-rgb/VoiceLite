<Window x:Class="VoiceLite.SettingsWindowNew"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:VoiceLite.Controls"
        mc:Ignorable="d"
        Title="VoiceLite Settings" Height="650" Width="850"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        MinHeight="500" MinWidth="700"
        PreviewKeyDown="Window_PreviewKeyDown">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#FAFAFA" Padding="20,15">
            <Grid>
                <TextBlock Text="VoiceLite Settings" FontSize="20" FontWeight="SemiBold" Foreground="#333333" HorizontalAlignment="Left"/>
                <TextBlock Name="VersionText" Text="" FontSize="12" Foreground="#95A5A6" HorizontalAlignment="Right" VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Tabbed Content -->
        <TabControl Grid.Row="1"
                    Name="SettingsTabControl"
                    TabStripPlacement="Top"
                    Margin="0"
                    BorderThickness="0"
                    Background="White">
            <TabControl.Resources>
                <Style TargetType="TabItem" BasedOn="{StaticResource ModernSettingsTabStyle}"/>
            </TabControl.Resources>

            <!-- General Settings Tab -->
            <TabItem Header="General">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel>
                        <!-- Hotkey Settings -->
                        <GroupBox Header="Hotkey Settings" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock Text="Record Hotkey:" Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" MaxWidth="300"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Name="HotkeyTextBox"
                                             Grid.Column="0"
                                             IsReadOnly="True"
                                             Text="F1"
                                             Padding="5"
                                             Background="#F0F0F0"
                                             PreviewKeyDown="HotkeyTextBox_PreviewKeyDown"
                                             GotFocus="HotkeyTextBox_GotFocus"
                                             LostFocus="HotkeyTextBox_LostFocus"/>

                                    <Button Name="ClearHotkeyButton"
                                            Grid.Column="1"
                                            Content="Clear"
                                            Width="60"
                                            Margin="5,0,0,0"
                                            Click="ClearHotkeyButton_Click"/>
                                </Grid>
                                <TextBlock Name="HotkeyInstructionText"
                                           Text="Click the box and press your desired key combination"
                                           FontSize="11"
                                           Foreground="Gray"
                                           Margin="0,5,0,0"
                                           Visibility="Visible"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Recording Mode -->
                        <GroupBox Header="Recording Mode" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <RadioButton Name="ToggleRadio"
                                             Content="Toggle (Press once to start, press again to stop) - Recommended"
                                             IsChecked="True"
                                             Margin="0,0,0,5"/>
                                <RadioButton Name="PushToTalkRadio"
                                             Content="Push-to-Talk (Hold key while speaking)"
                                             IsEnabled="True"/>
                                <TextBlock Text="Toggle mode provides a Dragon-like experience for longer dictation sessions."
                                          Foreground="Gray"
                                          FontSize="11"
                                          Margin="20,5,0,0"
                                          TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Transcription Quality -->
                        <GroupBox Header="Transcription Quality" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock Text="Quality Preset:" Margin="0,0,0,5"/>
                                <ComboBox Name="TranscriptionPresetComboBox"
                                          Margin="0,0,0,10"
                                          MaxWidth="400"
                                          HorizontalAlignment="Left"
                                          SelectionChanged="TranscriptionPresetComboBox_SelectionChanged">
                                    <ComboBoxItem Content="⚖️ Balanced - Good speed and accuracy (recommended)" Tag="Balanced" IsSelected="True"/>
                                    <ComboBoxItem Content="🎯 Accuracy - Highest quality (slower)" Tag="Accuracy"/>
                                    <ComboBoxItem Content="⚡ Speed - Fastest transcription" Tag="Speed"/>
                                </ComboBox>
                                <TextBlock Name="PresetDescriptionText"
                                           Text="Balanced speed and accuracy - Recommended for most users"
                                           FontSize="11"
                                           Foreground="Gray"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,10"/>

                                <!-- VAD Settings -->
                                <CheckBox Name="EnableVADCheckBox"
                                          Content="Enable Voice Activity Detection (VAD)"
                                          IsChecked="True"
                                          Margin="0,0,0,5"
                                          Checked="EnableVADCheckBox_Changed"
                                          Unchecked="EnableVADCheckBox_Changed"
                                          ToolTip="Automatically removes silence and background noise before transcription"/>

                                <StackPanel Name="VADSettingsPanel" Margin="20,5,0,0">
                                    <TextBlock Text="VAD Sensitivity:" Margin="0,0,0,5" FontSize="11"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" MaxWidth="300"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider Name="VADThresholdSlider"
                                                Grid.Column="0"
                                                Minimum="0.3"
                                                Maximum="0.8"
                                                Value="0.5"
                                                TickFrequency="0.1"
                                                IsSnapToTickEnabled="True"
                                                TickPlacement="BottomRight"
                                                Margin="0,0,10,0"
                                                ValueChanged="VADThresholdSlider_ValueChanged"/>
                                        <TextBlock Name="VADThresholdText"
                                                   Grid.Column="1"
                                                   Text="0.50"
                                                   FontSize="11"
                                                   VerticalAlignment="Center"
                                                   MinWidth="35"
                                                   TextAlignment="Right"/>
                                    </Grid>
                                    <TextBlock Text="Lower = More sensitive (may include background noise)"
                                               FontSize="10"
                                               Foreground="Gray"
                                               Margin="0,3,0,0"
                                               TextWrapping="Wrap"/>
                                    <TextBlock Text="Higher = Less sensitive (may cut off quiet speech)"
                                               FontSize="10"
                                               Foreground="Gray"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <!-- Audio Settings -->
                        <GroupBox Header="Audio Settings" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock Text="Microphone:" Margin="0,0,0,5"/>
                                <ComboBox Name="MicrophoneComboBox"
                                          Margin="0,0,0,10"
                                          DisplayMemberPath="Name"
                                          MaxWidth="400"
                                          HorizontalAlignment="Left"/>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <Button Name="RefreshMicrophonesButton"
                                            Content="Refresh Microphones"
                                            Width="150"
                                            HorizontalAlignment="Left"
                                            Click="RefreshMicrophonesButton_Click"
                                            Margin="0,0,8,0"/>
                                    <Button Name="TestMicrophoneButton"
                                            Content="Test Microphone"
                                            Width="130"
                                            HorizontalAlignment="Left"
                                            Click="TestMicrophoneButton_Click"
                                            ToolTip="Click to start/stop recording test"/>
                                </StackPanel>

                                <CheckBox Name="AutoPasteCheckBox"
                                          Content="Auto-paste transcribed text (Ctrl+V)"
                                          IsChecked="True"
                                          Margin="0,0,0,10"
                                          ToolTip="When enabled, transcribed text will automatically paste into the active application. When disabled, text is only copied to clipboard."/>

                                <!-- Clipboard Restoration Delay -->
                                <TextBlock Text="Clipboard Restoration Delay:" Margin="0,0,0,5" FontSize="11"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" MaxWidth="300"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Name="ClipboardDelaySlider"
                                            Grid.Column="0"
                                            Minimum="30"
                                            Maximum="100"
                                            Value="50"
                                            TickFrequency="10"
                                            IsSnapToTickEnabled="True"
                                            TickPlacement="BottomRight"
                                            Margin="0,0,10,0"
                                            ValueChanged="ClipboardDelaySlider_ValueChanged"
                                            ToolTip="Time to wait before restoring your original clipboard content (30-100ms)"/>
                                    <TextBlock Name="ClipboardDelayLabel"
                                               Grid.Column="1"
                                               Text="50ms"
                                               FontSize="11"
                                               VerticalAlignment="Center"
                                               MinWidth="45"
                                               TextAlignment="Right"/>
                                </Grid>
                                <TextBlock Text="Lower = Faster but may lose clipboard data on slow systems"
                                           FontSize="10"
                                           Foreground="Gray"
                                           Margin="0,3,0,0"
                                           TextWrapping="Wrap"/>
                                <TextBlock Text="Higher = Slower but more reliable clipboard restoration"
                                           FontSize="10"
                                           Foreground="Gray"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- System Settings -->
                        <GroupBox Header="System Settings" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <CheckBox Name="MinimizeToTrayCheckBox"
                                          Content="Minimize to system tray on close"
                                          IsChecked="True"
                                          Margin="0,0,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Custom Shortcuts Tab -->
            <TabItem Header="Shortcuts" Name="ShortcutsTab">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel>
                        <!-- Header -->
                        <TextBlock Text="Custom Shortcuts"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,10"/>

                        <TextBlock TextWrapping="Wrap"
                                   Foreground="Gray"
                                   Margin="0,0,0,20"
                                   FontSize="12">
                            <Run Text="Create custom text expansion shortcuts. When you say the trigger phrase, it will be replaced with your custom text."/>
                            <LineBreak/>
                            <Run Text="Example: Say 'my email' → appears as 'john@example.com'"/>
                        </TextBlock>

                        <!-- Shortcuts List -->
                        <GroupBox Header="Your Shortcuts" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <ListView Name="ShortcutsListView"
                                          Height="250"
                                          Margin="0,0,0,10"
                                          SelectionMode="Single"
                                          MouseDoubleClick="ShortcutsListView_MouseDoubleClick">
                                    <ListView.View>
                                        <GridView>
                                            <GridViewColumn Header="Trigger" Width="150" DisplayMemberBinding="{Binding Trigger}"/>
                                            <GridViewColumn Header="Replacement" Width="250" DisplayMemberBinding="{Binding Replacement}"/>
                                            <GridViewColumn Header="Enabled" Width="70">
                                                <GridViewColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsChecked="{Binding IsEnabled}" IsHitTestVisible="False"/>
                                                    </DataTemplate>
                                                </GridViewColumn.CellTemplate>
                                            </GridViewColumn>
                                        </GridView>
                                    </ListView.View>
                                </ListView>

                                <!-- Action Buttons -->
                                <StackPanel Orientation="Horizontal">
                                    <Button Name="AddShortcutButton"
                                            Content="Add Shortcut"
                                            Width="100"
                                            Height="32"
                                            Click="AddShortcutButton_Click"
                                            Margin="0,0,5,0"/>
                                    <Button Name="EditShortcutButton"
                                            Content="Edit"
                                            Width="80"
                                            Height="32"
                                            Click="EditShortcutButton_Click"
                                            IsEnabled="False"
                                            Margin="0,0,5,0"/>
                                    <Button Name="DeleteShortcutButton"
                                            Content="Delete"
                                            Width="80"
                                            Height="32"
                                            Click="DeleteShortcutButton_Click"
                                            IsEnabled="False"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- AI Models Tab (Pro Only) -->
            <TabItem Header="AI Models" Name="AIModelsTab">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel>
                        <TextBlock Text="AI Model Selection"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,10"/>

                        <TextBlock TextWrapping="Wrap"
                                   Foreground="Gray"
                                   Margin="0,0,0,20"
                                   FontSize="12">
                            <Run Text="Select which AI model to use for speech recognition. "/>
                            <Run Text="Larger models offer better accuracy but require more RAM and processing time."/>
                        </TextBlock>

                        <!-- Model Download Control -->
                        <controls:ModelDownloadControl x:Name="ModelDownloadControl"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- License Tab -->
            <TabItem Header="License">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                    <StackPanel>
                        <!-- Current License Status -->
                        <GroupBox Header="License Status" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="Current Tier: " FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <TextBlock Name="LicenseTierText"
                                               Text="Free"
                                               FontWeight="Bold"
                                               FontSize="14"
                                               Foreground="#2563EB"
                                               VerticalAlignment="Center"
                                               Margin="5,0,0,0"/>
                                </StackPanel>

                                <Border Background="#F0F9FF"
                                        BorderBrush="#BAE6FD"
                                        BorderThickness="1"
                                        CornerRadius="5"
                                        Padding="15"
                                        Margin="0,0,0,0">
                                    <StackPanel>
                                        <TextBlock Name="LicenseDescriptionText"
                                                   TextWrapping="Wrap"
                                                   Foreground="#1E3A8A"
                                                   FontSize="12">
                                            <Run Text="Free tier includes the Tiny model (80-85% accuracy)."/>
                                            <LineBreak/>
                                            <Run Text="Upgrade to Pro to unlock all 5 AI models (90-98% accuracy) and in-app model downloads."/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </GroupBox>

                        <!-- Activate License -->
                        <GroupBox Header="Activate Pro License" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock Text="Enter your license key to unlock Pro features:"
                                           Margin="0,0,0,10"
                                           TextWrapping="Wrap"/>

                                <TextBlock Text="License Key:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                <TextBox Name="LicenseKeyInput"
                                         FontFamily="Consolas"
                                         FontSize="13"
                                         Padding="8"
                                         MaxWidth="400"
                                         HorizontalAlignment="Left"
                                         Margin="0,0,0,10"
                                         ToolTip="Paste your license key here"/>

                                <Button Name="ActivateLicenseButton"
                                        Content="Activate License"
                                        Width="150"
                                        Height="32"
                                        HorizontalAlignment="Left"
                                        Click="ActivateLicenseButton_Click"
                                        Margin="0,0,0,10"/>

                                <TextBlock Name="LicenseStatusText"
                                           Margin="0,5,0,0"
                                           FontWeight="SemiBold"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Pro Features Info -->
                        <GroupBox Header="Pro Features" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock Text="Unlock with Pro license:" FontWeight="SemiBold" Margin="0,0,0,10"/>
                                <StackPanel Margin="10,0,0,0">
                                    <TextBlock Margin="0,3,0,3">
                                        <Run Text="✓" Foreground="Green" FontWeight="Bold"/>
                                        <Run Text=" All 5 AI models (Tiny, Swift, Pro, Elite, Ultra)"/>
                                    </TextBlock>
                                    <TextBlock Margin="0,3,0,3">
                                        <Run Text="✓" Foreground="Green" FontWeight="Bold"/>
                                        <Run Text=" 90-98% accuracy (vs 80-85% free)"/>
                                    </TextBlock>
                                    <TextBlock Margin="0,3,0,3">
                                        <Run Text="✓" Foreground="Green" FontWeight="Bold"/>
                                        <Run Text=" Lifetime updates"/>
                                    </TextBlock>
                                    <TextBlock Margin="0,3,0,3">
                                        <Run Text="✓" Foreground="Green" FontWeight="Bold"/>
                                        <Run Text=" Commercial use allowed"/>
                                    </TextBlock>
                                    <TextBlock Margin="0,3,0,3">
                                        <Run Text="✓" Foreground="Green" FontWeight="Bold"/>
                                        <Run Text=" Priority support"/>
                                    </TextBlock>
                                </StackPanel>

                                <Border Background="#FEF3C7"
                                        BorderBrush="#FCD34D"
                                        BorderThickness="1"
                                        CornerRadius="5"
                                        Padding="12"
                                        Margin="0,15,0,0">
                                    <StackPanel>
                                        <TextBlock Text="Don't have a license yet?"
                                                   FontWeight="SemiBold"
                                                   Margin="0,0,0,5"/>
                                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,8">
                                            <Run Text="Get VoiceLite Pro for just $20 (one-time payment, no subscription)."/>
                                        </TextBlock>
                                        <Button Name="BuyProButton"
                                                Content="Buy Pro License - $20"
                                                Width="180"
                                                Height="32"
                                                Background="#2563EB"
                                                Foreground="White"
                                                BorderThickness="0"
                                                HorizontalAlignment="Left"
                                                Click="BuyProButton_Click"
                                                Cursor="Hand"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Footer with Buttons -->
        <Border Grid.Row="2"
                Background="#F5F5F5"
                BorderBrush="#E0E0E0"
                BorderThickness="0,1,0,0">
            <Grid Margin="20,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status Text and Keyboard Shortcuts Hint -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Name="StatusText"
                               Text=""
                               FontSize="12"
                               Foreground="#606060"
                               VerticalAlignment="Center"
                               Margin="0,0,15,0"/>
                    <TextBlock Text="💡 Tip: Ctrl+S to save, Esc to cancel"
                               FontSize="11"
                               Foreground="#95A5A6"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Name="ApplyButton"
                            Content="Apply"
                            Width="80"
                            Margin="0,0,10,0"
                            Click="ApplyButton_Click"/>
                    <Button Name="SaveButton"
                            Content="Save"
                            Width="80"
                            Margin="0,0,10,0"
                            Click="SaveButton_Click"
                            IsDefault="True"/>
                    <Button Name="CancelButton"
                            Content="Cancel"
                            Width="80"
                            Click="CancelButton_Click"
                            IsCancel="True"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
