# Story 2.2.2: Create Test Category System

**Epic**: 2.2 Integration Test Optimization
**Status**: ðŸš€ IN PROGRESS
**Estimated Effort**: 1 hour
**Assignee**: Claude (autonomous)
**Created**: 2025-10-11

## Objective

Define and apply test categories using xUnit `[Trait]` attributes for fast/slow test filtering.

## Tasks

- [ ] Define test categories (Unit, Hardware, FileIO, Integration, UI)
- [ ] Apply `[Trait]` attributes to all 540 tests
- [ ] Verify filter commands work correctly
- [ ] Update test documentation

## Test Categories

### 1. Unit (`[Trait("Category", "Unit")]`)
**Description**: Fast logic tests with no external dependencies
**Runtime**: <10ms average
**Count**: ~500 tests
**Examples**:
- Models/ tests (SettingsTests, WhisperModelInfoTests, TranscriptionHistoryItemTests)
- Utilities/ tests (StatusColorsTests, TextAnalyzerTests, TimingConstantsTests)
- Service logic tests (TextInjectorTests logic methods, HotkeyManagerTests logic methods)

### 2. Hardware (`[Trait("Category", "Hardware")]`)
**Description**: Tests requiring audio hardware simulation
**Runtime**: 100-200ms average
**Count**: ~15 tests
**Examples**:
- AudioRecorderTests (device enumeration, recording start/stop)
- MemoryMonitorTests (GC operations, timing-dependent)

### 3. FileIO (`[Trait("Category", "FileIO")]`)
**Description**: Tests with file I/O operations
**Runtime**: 100-400ms average
**Count**: ~8 tests
**Examples**:
- AudioPreprocessorTests (WAV file processing)
- ErrorLoggerTests (log file operations)
- ResourceLifecycleTests (temp file cleanup)

### 4. Integration (`[Trait("Category", "Integration")]`)
**Description**: Tests requiring real hardware or external processes
**Runtime**: Variable (usually skipped)
**Count**: 17 tests (already skipped)
**Examples**:
- WhisperServiceTests (require whisper.exe + audio)
- AudioPipelineTests (end-to-end flow)

### 5. UI (`[Trait("Category", "UI")]`)
**Description**: Tests requiring WPF UI thread or MainWindow
**Runtime**: Variable (usually skipped)
**Count**: ~13 tests
**Examples**:
- SystemTrayManagerTests (WPF UI thread required)
- MainWindowDisposalTests (MainWindow instantiation)

## Test File Categorization Plan

**Unit Tests** (apply to entire class):
- âœ… AppProcessDetectionTests â†’ Unit
- âœ… Models/SettingsTests â†’ Unit
- âœ… Models/TranscriptionHistoryItemTests â†’ Unit
- âœ… Models/WhisperModelInfoTests â†’ Unit
- âœ… Utilities/StatusColorsTests â†’ Unit
- âœ… Utilities/TimingConstantsTests â†’ Unit
- âœ… Utilities/TextAnalyzerTests â†’ Unit
- âœ… Utilities/RelativeTimeConverterTests â†’ Unit
- âœ… Utilities/TruncateTextConverterTests â†’ Unit
- âœ… Services/TextInjectorTests â†’ Unit (logic methods)
- âœ… Services/HotkeyManagerTests â†’ Unit (logic methods)
- âœ… Services/TranscriptionHistoryServiceTests â†’ Unit
- âœ… Services/DependencyCheckerTests â†’ Unit
- âœ… Services/StartupDiagnosticsTests â†’ Unit
- âœ… Services/ZombieProcessCleanupServiceTests â†’ Unit
- âœ… Services/WhisperErrorRecoveryTests â†’ Unit

**Hardware Tests** (apply per test or class):
- âœ… Services/AudioRecorderTests â†’ Hardware (15 tests)
- âœ… Services/MemoryMonitorTests â†’ Hardware (8 tests)

**FileIO Tests** (apply per test):
- âœ… Services/AudioPreprocessorTests â†’ FileIO (8 tests)
- âœ… Services/ErrorLoggerTests â†’ FileIO (file operations)
- âœ… Resources/ResourceLifecycleTests â†’ FileIO (temp cleanup tests)

**Integration Tests** (already marked):
- âœ… Services/WhisperServiceTests â†’ Integration (already skipped)
- âœ… Integration/AudioPipelineTests â†’ Integration (already skipped)

**UI Tests** (already marked):
- âœ… Services/SystemTrayManagerTests â†’ UI (already skipped)
- âœ… Resources/MainWindowDisposalTests â†’ UI (some tests)

## Filter Commands

After categorization, developers can use:

```bash
# Fast feedback loop (<5 seconds) - Unit tests only
dotnet test --filter "Category=Unit"

# Medium tests (~10-15 seconds) - Hardware + FileIO
dotnet test --filter "Category=Hardware|Category=FileIO"

# All non-integration tests (~20-25 seconds)
dotnet test --filter "Category!=Integration&Category!=UI"

# Full suite (including skipped tests)
dotnet test

# Specific category
dotnet test --filter "Category=FileIO"
```

## Acceptance Criteria

- [ ] All 540 tests have `[Trait("Category", "...")]` attribute
- [ ] Filter commands return expected test counts
- [ ] All tests still pass after categorization
- [ ] Documentation updated with filter commands

## Implementation Strategy

1. **Add class-level traits** for homogeneous test files (e.g., all Unit)
2. **Add method-level traits** for mixed test files (e.g., some Hardware, some FileIO)
3. **Verify counts** using `dotnet test --list-tests --filter "Category=X"`
4. **Run each category** to ensure all pass

## Expected Test Counts After Categorization

- Unit: ~500 tests
- Hardware: ~15 tests
- FileIO: ~8 tests
- Integration: 17 tests (already exists)
- UI: ~13 tests (already exists)

**Total**: 540 tests (no change)

## Next Steps

Story 2.2.3 will verify filtering works and update CI workflows to use fast feedback loop.
